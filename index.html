<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Key Player</title>
</head>

<body>

<h2>キー変更プレイヤー</h2>

<input type="file" id="file"><br><br>

<audio id="audio" controls></audio>

<h3>キー</h3>
<button onclick="pitchDown()">−</button>
<span id="pitchVal">0</span>
<button onclick="pitchUp()">＋</button>

<script src="https://cdn.jsdelivr.net/npm/soundtouchjs@0.1.30/dist/soundtouch.min.js"></script>

<script>
let audio = document.getElementById("audio");
let ctx = new (window.AudioContext || window.webkitAudioContext)();
let pitch = 0;
let node;

document.getElementById("file").onchange = e=>{
    audio.src = URL.createObjectURL(e.target.files[0]);
};

audio.onplay = ()=>{
    ctx.resume();

    const src = ctx.createMediaElementSource(audio);

    const st = new soundtouch.SoundTouch(ctx.sampleRate);
    st.pitch = Math.pow(2, pitch/12);

    node = soundtouch.getWebAudioNode(ctx, src, st);
    node.connect(ctx.destination);
};

function pitchUp(){
    pitch++;
    document.getElementById("pitchVal").innerText = pitch;
}
function pitchDown(){
    pitch--;
    document.getElementById("pitchVal").innerText = pitch;
}
</script>

</body>
</html>
